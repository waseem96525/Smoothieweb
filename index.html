<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smoothie Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Razorpay (Demo) -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Arial, sans-serif;
  background:#f4f7f6;
}

/* NAVBAR */
nav{
  height:60px;
  background:#ffffff;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 16px;
  box-shadow:0 2px 10px rgba(0,0,0,.1);
}
nav button{
  padding:8px 12px;
  border:none;
  background:#4caf50;
  color:white;
  border-radius:6px;
}

/* LAYOUT */
.container{
  max-width:900px;
  margin:auto;
  padding:16px;
}
.card{
  background:white;
  padding:16px;
  border-radius:12px;
  margin-bottom:16px;
}
button{
  padding:10px;
  margin-top:8px;
  width:100%;
  border:none;
  border-radius:6px;
  background:#4caf50;
  color:white;
  font-size:16px;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal.active{display:flex}
.modal-box{
  background:white;
  padding:20px;
  border-radius:12px;
  width:90%;
  max-width:400px;
}
.modal-box input{
  width:100%;
  padding:10px;
  margin:8px 0;
}

/* CART */
.cart-item{
  display:flex;
  justify-content:space-between;
  margin:6px 0;
}
</style>
</head>

<body>

<nav>
  <strong>ðŸ¥¤ Smoothie</strong>
  <div id="navActions"></div>
</nav>

<div class="container" id="app"></div>

<!-- LOGIN MODAL -->
<div class="modal" id="loginModal">
  <div class="modal-box">
    <h3>Login</h3>
    <input id="loginEmail" placeholder="Email">
    <input id="loginPassword" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- CART MODAL -->
<div class="modal" id="cartModal">
  <div class="modal-box">
    <h3>Your Cart</h3>
    <div id="cartItems"></div>
    <p><strong>Total â‚¹<span id="cartTotal">0</span></strong></p>
    <button onclick="checkout()">Checkout</button>
  </div>
</div>

<script>
/* ---------------- AUTH ---------------- */
let currentUser = JSON.parse(localStorage.getItem("currentUser"));

function login(){
  const email = document.getElementById("loginEmail").value.trim();
  if(!email){
    alert("Enter email");
    return;
  }
  currentUser = { email };
  localStorage.setItem("currentUser", JSON.stringify(currentUser));
  closeModal("loginModal");
  render();
}

function logout(){
  localStorage.removeItem("currentUser");
  currentUser = null;
  render();
}

/* ---------------- STORAGE ---------------- */
function getCart(){
  return JSON.parse(localStorage.getItem(currentUser.email+"_cart")) || [];
}
function saveCart(cart){
  localStorage.setItem(currentUser.email+"_cart", JSON.stringify(cart));
}
function getOrders(){
  return JSON.parse(localStorage.getItem(currentUser.email+"_orders")) || [];
}
function saveOrders(orders){
  localStorage.setItem(currentUser.email+"_orders", JSON.stringify(orders));
}

/* ---------------- UI ---------------- */
function render(){
  const nav = document.getElementById("navActions");
  const app = document.getElementById("app");

  if(!currentUser){
    nav.innerHTML = `<button onclick="openModal('loginModal')">Login</button>`;
    app.innerHTML = `<div class="card"><h2>Please login to continue</h2></div>`;
    return;
  }

  nav.innerHTML = `
    <button onclick="openCart()">Cart</button>
    <button onclick="logout()">Logout</button>
  `;

  app.innerHTML = `
    <div class="card">
      <h2>Order Smoothie</h2>
      <button onclick="addToCart('Green Glow',120)">Green Glow â€“ â‚¹120</button>
      <button onclick="addToCart('Berry Blast',140)">Berry Blast â€“ â‚¹140</button>
    </div>

    <div class="card">
      <h2>Order History</h2>
      ${renderOrders()}
    </div>
  `;
}

function renderOrders(){
  const orders = getOrders();
  if(orders.length===0) return "<p>No orders yet</p>";
  return orders.map(o =>
    `<p>${o.items.join(", ")} â€” â‚¹${o.total}</p>`
  ).join("");
}

/* ---------------- CART ---------------- */
function addToCart(name, price){
  const cart = getCart();
  cart.push({name,price});
  saveCart(cart);
  alert("Added to cart");
}

function openCart(){
  const cart = getCart();
  document.getElementById("cartItems").innerHTML =
    cart.map(i=>`<div class="cart-item">${i.name} â‚¹${i.price}</div>`).join("");
  document.getElementById("cartTotal").innerText =
    cart.reduce((s,i)=>s+i.price,0);
  openModal("cartModal");
}

/* ---------------- CHECKOUT ---------------- */
function checkout(){
  const cart = getCart();
  if(cart.length===0){
    alert("Cart empty");
    return;
  }
  const total = cart.reduce((s,i)=>s+i.price,0);

  const options = {
    key:"rzp_test_123456789",
    amount: total*100,
    currency:"INR",
    handler:function(){
      const orders = getOrders();
      orders.push({
        items: cart.map(i=>i.name),
        total,
        date: new Date().toLocaleString()
      });
      saveOrders(orders);
      saveCart([]);
      closeModal("cartModal");
      alert("Payment successful");
      render();
    }
  };
  new Razorpay(options).open();
}

/* ---------------- MODAL HELPERS ---------------- */
function openModal(id){
  document.getElementById(id).classList.add("active");
}
function closeModal(id){
  document.getElementById(id).classList.remove("active");
}
document.querySelectorAll(".modal").forEach(m=>{
  m.addEventListener("click",e=>{
    if(e.target===m) m.classList.remove("active");
  });
});

/* INIT */
render();
</script>

</body>
</html>
