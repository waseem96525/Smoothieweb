<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smoothé – Ordering App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Razorpay (Demo) -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Inter,sans-serif;background:#f6f8f7}
button{cursor:pointer}

/* NAV */
nav{
  height:64px;
  background:white;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:0 1.5rem;
  box-shadow:0 10px 20px rgba(0,0,0,.05);
}
nav button{margin-left:.5rem}

/* LAYOUT */
.container{padding:2rem;max-width:900px;margin:auto}
.card{background:white;padding:1.5rem;border-radius:16px;margin-bottom:1rem}

/* MODAL */
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.5);
  display:none;align-items:center;justify-content:center;
}
.modal.active{display:flex}
.modal-box{
  background:white;padding:2rem;border-radius:16px;width:90%;max-width:400px;
}

/* CART */
.cart-item{display:flex;justify-content:space-between;margin:.5rem 0}
</style>
</head>

<body>

<nav>
  <strong>Smoothé</strong>
  <div id="navActions"></div>
</nav>

<div class="container" id="app"></div>

<!-- AUTH MODAL -->
<div class="modal" id="authModal">
  <div class="modal-box">
    <h3 id="authTitle">Login</h3>
    <input id="email" placeholder="Email" style="width:100%;margin:.5rem 0">
    <input id="password" type="password" placeholder="Password" style="width:100%;margin:.5rem 0">
    <button onclick="submitAuth()" style="width:100%">Submit</button>
  </div>
</div>

<!-- CART MODAL -->
<div class="modal" id="cartModal">
  <div class="modal-box">
    <h3>Your Cart</h3>
    <div id="cartItems"></div>
    <p><strong>Total ₹<span id="cartTotal"></span></strong></p>
    <button onclick="checkout()">Checkout</button>
  </div>
</div>

<script>
/* ---------- AUTH ---------- */
let currentUser = JSON.parse(localStorage.getItem('user'));

function showAuth(){
  document.getElementById('authModal').classList.add('active');
}
function submitAuth(){
  const email = email.value;
  localStorage.setItem('user',JSON.stringify({email}));
  currentUser = {email};
  authModal.classList.remove('active');
  render();
}
function logout(){
  localStorage.removeItem('user');
  currentUser=null;
  render();
}

/* ---------- DATA ---------- */
function getCart(){return JSON.parse(localStorage.getItem(currentUser.email+'_cart'))||[]}
function saveCart(c){localStorage.setItem(currentUser.email+'_cart',JSON.stringify(c))}
function getOrders(){return JSON.parse(localStorage.getItem(currentUser.email+'_orders'))||[]}
function saveOrders(o){localStorage.setItem(currentUser.email+'_orders',JSON.stringify(o))}

/* ---------- UI ---------- */
function render(){
  const nav = document.getElementById('navActions');
  const app = document.getElementById('app');

  if(!currentUser){
    nav.innerHTML = `<button onclick="showAuth()">Login</button>`;
    app.innerHTML = `<div class="card"><h2>Please login to order</h2></div>`;
    return;
  }

  nav.innerHTML = `
    <button onclick="openCart()">Cart</button>
    <button onclick="logout()">Logout</button>
  `;

  app.innerHTML = `
    <div class="card">
      <h2>Create Smoothie</h2>
      <button onclick="addToCart('Green Glow',120)">Add Green Glow – ₹120</button>
      <button onclick="addToCart('Berry Burst',140)">Add Berry Burst – ₹140</button>
    </div>

    <div class="card">
      <h2>Order History</h2>
      ${getOrders().map(o=>`<p>${o.items.join(', ')} – ₹${o.total}</p>`).join('')||'No orders'}
    </div>
  `;
}

/* ---------- CART ---------- */
function addToCart(name,price){
  const cart = getCart();
  cart.push({name,price});
  saveCart(cart);
  alert('Added to cart');
}

function openCart(){
  const cart = getCart();
  cartItems.innerHTML = cart.map(i=>`<div class="cart-item">${i.name} ₹${i.price}</div>`).join('');
  cartTotal.innerText = cart.reduce((s,i)=>s+i.price,0);
  cartModal.classList.add('active');
}

/* ---------- CHECKOUT ---------- */
function checkout(){
  const cart = getCart();
  const total = cart.reduce((s,i)=>s+i.price,0);

  const options = {
    key: "rzp_test_123456789", // DEMO KEY
    amount: total*100,
    currency: "INR",
    handler: function(){
      const orders = getOrders();
      orders.push({items:cart.map(i=>i.name),total,date:new Date()});
      saveOrders(orders);
      saveCart([]);
      cartModal.classList.remove('active');
      alert("Payment Successful!");
      render();
    }
  };
  new Razorpay(options).open();
}

/* INIT */
render();
</script>

</body>
</html>
