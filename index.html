<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smoothie Billing System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:#f4f7f6;
}

/* NAVBAR */
nav{
  height:60px;
  background:#ffffff;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 16px;
  box-shadow:0 2px 10px rgba(0,0,0,.08);
}
nav button{
  padding:8px 14px;
  border:none;
  background:#2ecc71;
  color:white;
  border-radius:6px;
  font-weight:600;
}

/* LAYOUT */
.container{
  max-width:900px;
  margin:auto;
  padding:16px;
}
.card{
  background:white;
  padding:16px;
  border-radius:14px;
  margin-bottom:16px;
}
.card h2{margin-bottom:12px}
button{
  padding:12px;
  margin-top:8px;
  width:100%;
  border:none;
  border-radius:8px;
  background:#2ecc71;
  color:white;
  font-size:16px;
  font-weight:600;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}
.modal.active{display:flex}
.modal-box{
  background:white;
  padding:20px;
  border-radius:14px;
  width:90%;
  max-width:420px;
}
.modal-box input{
  width:100%;
  padding:10px;
  margin:8px 0;
}

/* CART */
.cart-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:6px 0;
}
.cart-item span{font-weight:500}
.total{
  font-size:18px;
  font-weight:700;
  margin-top:10px;
  text-align:right;
}

/* MOBILE */
@media(max-width:600px){
  nav strong{font-size:18px}
}
</style>
</head>

<body>

<nav>
  <strong>ðŸ¥¤ Smoothie Billing</strong>
  <div id="navActions"></div>
</nav>

<div class="container" id="app"></div>

<!-- LOGIN MODAL -->
<div class="modal" id="loginModal">
  <div class="modal-box">
    <h3>Login</h3>
    <input id="loginEmail" placeholder="Email">
    <input id="loginPassword" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>
</div>

<!-- CART MODAL -->
<div class="modal" id="cartModal">
  <div class="modal-box">
    <h3>Current Bill</h3>
    <div id="cartItems"></div>
    <div class="total">Total â‚¹<span id="cartTotal">0</span></div>
    <button onclick="completeBill()">Complete Bill</button>
  </div>
</div>

<script>
/* ---------------- AUTH ---------------- */
let currentUser = JSON.parse(localStorage.getItem("currentUser"));

function login(){
  const email = document.getElementById("loginEmail").value.trim();
  if(!email){
    alert("Enter email");
    return;
  }
  currentUser = { email };
  localStorage.setItem("currentUser", JSON.stringify(currentUser));
  closeModal("loginModal");
  render();
}

function logout(){
  localStorage.removeItem("currentUser");
  currentUser = null;
  render();
}

/* ---------------- STORAGE ---------------- */
function getCart(){
  return JSON.parse(localStorage.getItem(currentUser.email+"_cart")) || [];
}
function saveCart(cart){
  localStorage.setItem(currentUser.email+"_cart", JSON.stringify(cart));
}
function getBills(){
  return JSON.parse(localStorage.getItem(currentUser.email+"_bills")) || [];
}
function saveBills(bills){
  localStorage.setItem(currentUser.email+"_bills", JSON.stringify(bills));
}

/* ---------------- UI ---------------- */
function render(){
  const nav = document.getElementById("navActions");
  const app = document.getElementById("app");

  if(!currentUser){
    nav.innerHTML = `<button onclick="openModal('loginModal')">Login</button>`;
    app.innerHTML = `<div class="card"><h2>Please login to start billing</h2></div>`;
    return;
  }

  nav.innerHTML = `
    <button onclick="openCart()">Current Bill</button>
    <button onclick="logout()">Logout</button>
  `;

  app.innerHTML = `
    <div class="card">
      <h2>Add Items</h2>
      <button onclick="addToCart('Green Glow',120)">Green Glow â€“ â‚¹120</button>
      <button onclick="addToCart('Berry Blast',140)">Berry Blast â€“ â‚¹140</button>
      <button onclick="addToCart('Protein Punch',160)">Protein Punch â€“ â‚¹160</button>
    </div>

    <div class="card">
      <h2>Billing History</h2>
      ${renderBills()}
    </div>
  `;
}

function renderBills(){
  const bills = getBills();
  if(bills.length===0) return "<p>No bills generated yet</p>";
  return bills.map((b,i)=>`
    <p>
      #${i+1} | ${b.items.join(", ")} |
      â‚¹${b.total} | ${b.date}
    </p>
  `).join("");
}

/* ---------------- CART / BILLING ---------------- */
function addToCart(name, price){
  const cart = getCart();
  cart.push({name,price});
  saveCart(cart);
}

function openCart(){
  const cart = getCart();
  document.getElementById("cartItems").innerHTML =
    cart.map(i=>`
      <div class="cart-item">
        <span>${i.name}</span>
        <span>â‚¹${i.price}</span>
      </div>
    `).join("") || "<p>No items</p>";

  document.getElementById("cartTotal").innerText =
    cart.reduce((s,i)=>s+i.price,0);

  openModal("cartModal");
}

function completeBill(){
  const cart = getCart();
  if(cart.length===0){
    alert("No items in bill");
    return;
  }
  const total = cart.reduce((s,i)=>s+i.price,0);
  const bills = getBills();

  bills.push({
    items: cart.map(i=>i.name),
    total,
    date: new Date().toLocaleString()
  });

  saveBills(bills);
  saveCart([]);
  closeModal("cartModal");
  alert("Bill completed successfully");
  render();
}

/* ---------------- MODALS ---------------- */
function openModal(id){
  document.getElementById(id).classList.add("active");
}
function closeModal(id){
  document.getElementById(id).classList.remove("active");
}
document.querySelectorAll(".modal").forEach(m=>{
  m.addEventListener("click",e=>{
    if(e.target===m) m.classList.remove("active");
  });
});

/* INIT */
render();
</script>

</body>
</html>
